import{q as ee,C as te,H as se,r as i,s as oe,D as ae,E as le,o as c,c as p,a as o,b as d,x as w,U as F,v as a,t as y,F as j,y as U,G as V,K as A,M as I,V as ne,z as re,B as ie,W as ce}from"./entry.BtNxfFXi.js";import{B as ue}from"./BackIcon.C2wpftT-.js";import{C as N}from"./CloseIcon.ObWUlk8i.js";import{_ as pe,a as de,b as me,c as fe}from"./ChooseCallNumberInput.vue.BeQqZKkv.js";import{u as xe}from"./useCustomFetch.CTNm-nVq.js";import he from"./Loading.BtJReGTm.js";import"./ServiceItem.vue.Dp1Y5fXu.js";import"./ArrowUpIcon.PRYG8zVp.js";import"./DoneCheckIcon.BXzjlFpT.js";import"./Modal.vue.ziqBManD.js";import"./CheckBox.vue.CEWl44tu.js";import"./Auth.C9KdCeyF.js";import"./fetch.DJAD9rTR.js";const ve={class:"mt-[20px] w-full flex flex-col items-start justify-start pb-[108px] relative"},_e={class:"w-full relative flex flex-row items-center justify-center py-[23px]"},ge=o("div",{class:"font-semibold text-[16px] text-[#141414] leading-[24px]"},"نمونه کار",-1),be={class:"w-full flex flex-col my-[21px]"},we={class:"w-full flex flex-col gap-[12px] px-[14px] border-b border-b-[#A9A7A7]"},ye={class:"w-full flex flex-row items-start justify-between gap-[12px]"},ke={class:"w-full flex-col justify-start items-start"},Ce=o("div",{class:"font-medium text-right text-black text-[16px] leading-[21px]"},"عنوان",-1),$e={class:"w-full text-right text-[#828282] text-[14px] font-medium leading-[21px]"},Re=["src"],Fe={class:"w-full flex flex-row justify-start items-start gap-[12px] mt-[7px] flex-wrap"},je=["src"],Ue=["src"],Ve={class:"w-[80px] h-[80px] flex flex-col justify-center items-center px-[10px] absolute top-0 left-0 right-0 bottom-0 bg-[rgba(0,0,0,.5)]"},Ae={class:"h-[5px] w-full ltr-dir bg-white rounded-[5px] relative"},Ie={class:"text-center text-white text-[12px] mt-2"},Ne={class:"w-full flex flex-row items-start justify-between gap-[12px] mt-[7px]"},Pe={class:"w-full flex-col justify-start items-start"},Te=o("div",{class:"font-medium text-right text-black text-[16px] leading-[21px]"},"افزودن توضیحات",-1),Be={class:"w-full text-right text-[#828282] text-[14px] font-medium leading-[21px]"},qe={class:"w-full flex flex-col"},He=["disabled"],Se={key:0},De={key:1},st=ee({__name:"[id]",setup(ze){const u=I(),k=te(),C=se().params.id,{$putRequest:P}=I(),m=i(!1),$=i(),e=i({title:"",description:"",maintenance:"",service:null,price:0,discount_price:0,has_tel:!1,has_phone_number:!1,second_phone_number:"",images:[]}),f=i([]),x=i([]),h=i([]),v=i([]),_=i([]),g=i([]),T=()=>{k.replace("/panel/artist/portfolios")},B=t=>{e.value.price=t},q=t=>{e.value.discount_price=t},H=t=>{e.value.second_phone_number=t},S=t=>{e.value.has_phone_number=t},D=t=>{e.value.has_tel=t},z=()=>{var t;(t=$.value)==null||t.click()},L=async t=>{var l;h.value=[],x.value=[];const s=(l=t.target)==null?void 0:l.files;if(s.length!=0){for(let n=0;n<s.length;n++){const r=new FileReader;r.onload=()=>{x.value.push(r.result)},r.readAsDataURL(s[n])}h.value=s,await O()}},E=t=>{x.value.splice(t,1),_.value.splice(t,1)},M=t=>{f.value.splice(t,1)},X=t=>!g.value[t],O=async()=>{const t=h.value.length;v.value=Array(t).fill("0%"),_.value=Array(t).fill(null),g.value=Array(t).fill(!0);for(let s=0;s<t;s++)await G(h.value[s],s)},G=async(t,s)=>{const l=ne(),n=new FormData;n.append("file",t),n.append("type","portfolio");const r=new XMLHttpRequest,b=A("XSRF-TOKEN"),Y=A("token");r.open("post",l.public.uploadURL,!0),r.withCredentials=!0,r.setRequestHeader("accept","application/json"),r.setRequestHeader("X-Xsrf-Token",b.value),r.setRequestHeader("Authorization",`Bearer ${Y.value}`),r.upload.onprogress=function(R){const Z=R.loaded/R.total*100;v.value[s]=Z+"%"},r.onreadystatechange=function(){r.readyState},r.onload=()=>{r.status===200&&(_.value[s]=JSON.parse(r.responseText),setTimeout(()=>{g.value[s]=!1},1e3))},r.send(n)},K=oe(()=>e.value.images.length>0?e.value.images[0]:"/panel/choose-image.png"),J=()=>{let t=!0;return e.value.title||(u.$toast.error("لطفا عنوان نمونه کار را وارد کنید",{rtl:!0}),t=!1),e.value.description||(u.$toast.error("لطفا توضیحات نمونه کار را وارد کنید",{rtl:!0}),t=!1),e.value.service||(u.$toast.error("لطفا دسته بندی نمونه کار را انتخاب کنید",{rtl:!0}),t=!1),e.value.price||(u.$toast.error("لطفا قیمت نمونه کار را وارد کنید",{rtl:!0}),t=!1),f.value.length==0&&x.value.length==0&&(u.$toast.error("لطفا عکس های نمونه کار را انتخاب کنید",{rtl:!0}),t=!1),t},W=async()=>{var s;if(m.value||!J())return;m.value=!0;const t={title:e.value.title,description:e.value.description,maintenance:e.value.maintenance,service_id:(s=e.value.service)==null?void 0:s.id,price:e.value.price,discount_price:e.value.discount_price,has_tel:e.value.has_tel,has_phone_number:e.value.has_phone_number,second_phone_number:e.value.second_phone_number,images:[...f.value,..._.value.map(l=>l.url)]};P(`/own/portfolios/${C}`,t).then(async l=>{u.$toast.success("نمونه کار با موفقیت ویرایش شد"),await k.push("/panel/artist/portfolios")}).catch(l=>{const n=Object.values(l.data.errors);for(const r in n)for(const b in n[r])u.$toast.error(n[r][b],{rtl:!0})}).finally(()=>{m.value=!1})},Q=async()=>{const t=await xe(`/own/portfolios/${C}`,{method:"GET"});if(t.data.value){const s=t.data.value.data;e.value.title=s.title,e.value.description=s.description,e.value.maintenance=s.maintenance,e.value.price=s.price,e.value.discount_price=s.discount_price,e.value.has_tel=s.has_tel,e.value.has_phone_number=s.has_phone_number,e.value.second_phone_number=s.showing_phone_number,e.value.service=s.service,f.value=s.images}};return ae(()=>{le(()=>{Q()})}),(t,s)=>(c(),p("div",ve,[o("div",_e,[ge,d(ue,{onClick:T,class:"absolute left-[30px]"})]),o("div",be,[o("div",we,[o("div",ye,[o("div",ke,[Ce,w(o("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>a(e).title=l),class:"w-full px-[10px] py-[4px] mx-[10px] mt-[10px] outline-none focus:outline-none text-[16px]",placeholder:"کراتینه مو,کاشت مژه و...",maxlength:"40"},null,512),[[F,a(e).title]]),o("span",$e,"40 / "+y(a(e).title.length),1)]),o("img",{onClick:z,src:a(K),alt:"",class:"w-[80px] h-[80px]"},null,8,Re),o("input",{onChange:L,type:"file",hidden:"",multiple:"",accept:"image/png, images/jpeg",ref_key:"galleryChooser",ref:$},null,544)]),o("div",Fe,[(c(!0),p(j,null,U(a(f),(l,n)=>(c(),p("div",{class:"relative",key:n},[d(N,{onClick:r=>M(n),class:"absolute top-[-12px] right-[-12px] z-10"},null,8,["onClick"]),o("img",{class:"w-[80px] h-[80px]",src:l,alt:""},null,8,je)]))),128)),(c(!0),p(j,null,U(a(x),(l,n)=>(c(),p("div",{class:"relative",key:n},[X(n)?(c(),re(N,{key:0,onClick:r=>E(n),class:"absolute top-[-12px] right-[-12px] z-10"},null,8,["onClick"])):ie("",!0),o("img",{class:"w-[80px] h-[80px]",src:l,alt:""},null,8,Ue),w(o("div",Ve,[o("div",Ae,[o("div",{class:V(`bg-green-300 rounded-[5px] h-[5px] w-[${a(v)[n]}]`)},null,2),o("div",Ie,y(a(v)[n]),1)])],512),[[ce,a(g)[n]]])]))),128))]),o("div",Ne,[o("div",Pe,[Te,w(o("textarea",{"onUpdate:modelValue":s[1]||(s[1]=l=>a(e).description=l),class:"w-full px-[10px] py-[4px] mx-[10px] mt-[10px] outline-none focus:outline-none text-[16px]",placeholder:"کراتینه مو یک روش موثر برای صافی، درخشندگی و شادابی موهای فر ...",maxlength:"200",rows:"2"},`\r
          `,512),[[F,a(e).description]]),o("span",Be,"200 / "+y(a(e).description.length),1)])])]),o("div",qe,[d(pe,{modelValue:a(e).service,"onUpdate:modelValue":s[2]||(s[2]=l=>a(e).service=l)},null,8,["modelValue"]),d(de,{modelValue:a(e).maintenance,"onUpdate:modelValue":s[3]||(s[3]=l=>a(e).maintenance=l)},null,8,["modelValue"]),d(me,{"has-tel":a(e).has_tel,"has-phone-number":a(e).has_phone_number,"second-phone-number":a(e).second_phone_number,"onUpdate:hasTel":D,"onUpdate:hasPhoneNumber":S,"onUpdate:secondPhoneNumber":H},null,8,["has-tel","has-phone-number","second-phone-number"]),d(fe,{price:a(e).price,"discount-price":a(e).discount_price,"onUpdate:price":B,"onUpdate:discountPrice":q},null,8,["price","discount-price"])])]),o("button",{onClick:W,disabled:a(m),class:V([[a(m)?" bg-[rgb(177,177,177)]":" bg-[#FF3CA0]"],"absolute bottom-[30px] left-[22px] right-[22px] cursor-pointer font-semibold text-center text-[14px] leading-[22px] flex justify-center items-center text-white bg-[#FF3CA0] mt-[10px] rounded-full h-[44px]"])},[a(m)?(c(),p("span",Se,[d(he)])):(c(),p("span",De," انتشار "))],10,He)]))}});export{st as default};
